<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>MISMIP+ part one: grounding lines on overdeepened bed · WAVI.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="WAVI.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">WAVI.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../installation_instructions/">Installation instructions</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox" checked/><label class="tocitem" for="menuitem-3"><span class="docs-label">Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../planar_1D_flow/">First example: one-dimensional planar flow</a></li><li class="is-active"><a class="tocitem" href>MISMIP+ part one: grounding lines on overdeepened bed</a><ul class="internal"><li><a class="tocitem" href="#Install-dependencies"><span>Install dependencies</span></a></li><li><a class="tocitem" href="#Basal-Topography"><span>Basal Topography</span></a></li><li><a class="tocitem" href="#Boundary-Conditions"><span>Boundary Conditions</span></a></li><li><a class="tocitem" href="#Solver-Parameters"><span>Solver Parameters</span></a></li><li><a class="tocitem" href="#Make-the-model"><span>Make the model</span></a></li><li><a class="tocitem" href="#Assembling-the-Simulation"><span>Assembling the Simulation</span></a></li><li><a class="tocitem" href="#Timestepping"><span>Timestepping</span></a></li><li><a class="tocitem" href="#Visualization"><span>Visualization</span></a></li></ul></li><li><a class="tocitem" href="../mismip_plus_retreat/">MISMIP+ part two: retreat experiments</a></li><li><a class="tocitem" href="../bumpy_bed/">Two-dimensional flow on a bumpy bed</a></li><li><a class="tocitem" href="../melt_parametrizations/">Melt rate parametrizations</a></li><li><a class="tocitem" href="../stochastic_forcing/">Ice sheet retreat under stochastic forcing</a></li><li><a class="tocitem" href="../WAIS/">Real world: West Antarctic Ice Sheet</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">Physics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../physics/overview/">Overview</a></li><li><a class="tocitem" href="../../physics/governing_equations/">Governing Equations</a></li><li><a class="tocitem" href="../../physics/melting/">Basal Melt Rate Parametrizations</a></li></ul></li><li><a class="tocitem" href="../../numerical_procedure/numerical_procedure/">Numerical Implementation</a></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">API</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../data_structure/overview/">Overview</a></li><li><a class="tocitem" href="../../data_structure/simulations/">Simulations</a></li><li><a class="tocitem" href="../../data_structure/model/">Models</a></li><li><a class="tocitem" href="../../data_structure/timestepping_params/">Timestepping Parameters</a></li><li><a class="tocitem" href="../../data_structure/output_writing/">Output Writing</a></li><li><a class="tocitem" href="../../data_structure/grid/">Grid</a></li><li><a class="tocitem" href="../../data_structure/solver_parameters/">Solver Parameters</a></li><li><a class="tocitem" href="../../data_structure/params/">Physical Parameters</a></li><li><a class="tocitem" href="../../data_structure/initial_conditions/">Initial Conditions</a></li><li><a class="tocitem" href="../../data_structure/fields/">Fields</a></li><li><a class="tocitem" href="../../data_structure/melt_rate_models/">Basal Melt Rate Models</a></li></ul></li><li><a class="tocitem" href="../../mitgcm_coupling/">MITgcm coupling</a></li><li><a class="tocitem" href="../../contributing/">Contributors guide</a></li><li><a class="tocitem" href="../../contact/">Contact us</a></li><li><a class="tocitem" href="../../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>MISMIP+ part one: grounding lines on overdeepened bed</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>MISMIP+ part one: grounding lines on overdeepened bed</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/RJArthern/WAVI.jl/blob/main/docs/src/examples/mismip_plus.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="MISMIP-example-(part-1)"><a class="docs-heading-anchor" href="#MISMIP-example-(part-1)">MISMIP+ example (part 1)</a><a id="MISMIP-example-(part-1)-1"></a><a class="docs-heading-anchor-permalink" href="#MISMIP-example-(part-1)" title="Permalink"></a></h1><p>This example shows how to recreate the Marine Ice Sheet Model Intercomparison (MISMIP) (doi: 10.5194/tc-14-2283-2020) experiments. In this intercomparison exercise, a two-dimensional ice sheet is considered, with a grounding line that can stabilize on a section of bed which has a locally positive slope in the flow direction (commonly called retrograde). This is interesting because grounding lines on retrograde bedslopes are theoretically unstable in one horizontal dimension (see doi: 10.1029/2006JF000664), demonstrating the importance of variations in the second dimension for buttressing ice sheets. Note that here we use a very coarse (8km) resolution for computational speed. In this example, we demonstrate the MISMIP+ ice0 experiment, where the simulation is run to steady state with no melting; the other MISMIP+ experiments are shown in other examples.</p><p>This example demonstrates how to </p><ul><li>apply boundary conditions</li><li>control the number of iterations in the velocity solve</li><li>zip the output into nc file format</li></ul><h2 id="Install-dependencies"><a class="docs-heading-anchor" href="#Install-dependencies">Install dependencies</a><a id="Install-dependencies-1"></a><a class="docs-heading-anchor-permalink" href="#Install-dependencies" title="Permalink"></a></h2><p>First let&#39;s make sure we have all required packages installed.</p><pre><code class="language-julia hljs">using Pkg
Pkg.add(PackageSpec(url=&quot;https://github.com/RJArthern/WAVI.jl.git&quot;, rev = &quot;main&quot;))
Pkg.add(&quot;Plots&quot;)
Pkg.add(&quot;NetCDF&quot;)
using WAVI, Plots</code></pre><h2 id="Basal-Topography"><a class="docs-heading-anchor" href="#Basal-Topography">Basal Topography</a><a id="Basal-Topography-1"></a><a class="docs-heading-anchor-permalink" href="#Basal-Topography" title="Permalink"></a></h2><p>The MISMIP+ domain is 640km in the x-direction and 80km in the y-direction, centred around <span>$y = 0$</span>. The basal topography is given by <span>$z_b = \max [B_x(x) + B_y(y), -720]$</span> where <span>$B_x(x)$</span> is a sixth order, even polynomial and <span>$B_y(y)$</span> introduces two bumps in the domain. We write this analytic bed expression as a function</p><pre><code class="language-julia hljs">function mismip_plus_bed(x,y)
    xbar = 300000.0
    b0 = -150.0; b2 = -728.8; b4 = 343.91; b6 = -50.75;
    wc = 24000.0; fc = 4000.0; dc = 500.0;
    bx(x)=b0+b2*(x/xbar)^2+b4*(x/xbar)^4+b6*(x/xbar)^6;
    by(y)= dc*( (1+exp(-2(y-wc)/fc))^(-1) + (1+exp(2(y+wc)/fc))^(-1) );
    b = max(bx(x) + by(y), -720.0);
    return b;
end</code></pre><p>First, let&#39;s take a look at this bed. First we&#39;ll use a nice high resolution grid to get a nice plot, but when we run the simulation, we&#39;ll use a lower resolution for computational efficiency</p><pre><code class="language-julia hljs">dx = 1.e3;
dy = 1.e3;
nx = round(Int, 640*1e3/dx);
ny = round(Int, 80*1e3/dx);
xx=[i*dx for i=1:nx, j=1:ny];
yy=[j*dy for i=1:nx, j=1:ny] .- 42000;
x = xx[:,1];
y = yy[1,:];

# Now we can plot
plt =  Plots.heatmap(x/1e3, y/1e3, mismip_plus_bed.(xx,yy)&#39;, 
                    xlabel = &quot;x (km)&quot;, 
                    ylabel = &quot;y (km)&quot;,
                    colorbar_title = &quot;bed depth (m)&quot;)
plot!(size = (800,400))</code></pre><center><img src="https://raw.githubusercontent.com/RJArthern/WAVI.jl/build-docs/docs/src/assets/example-plots/MISMIP/mismip_bed.png" alt="" title="" width="600" height="600" /></center><h2 id="Boundary-Conditions"><a class="docs-heading-anchor" href="#Boundary-Conditions">Boundary Conditions</a><a id="Boundary-Conditions-1"></a><a class="docs-heading-anchor-permalink" href="#Boundary-Conditions" title="Permalink"></a></h2><p>In the MISMIP+ experiment, no slip (zero velocity in both directions) boundary conditions are applied at <span>$x = 0$</span>, and free-slip boundary conditions (zero velocity in the direction normal to the walls) are applied at the lateral boundaries at <span>$y = 0$</span>km and <span>$y = 84$</span>km. First, let&#39;s redefine the grid size to be lower resolution (to make the later simulations quicker)</p><pre><code class="language-julia hljs">dx = 8.e3;
dy = 8.e3;
nx = round(Int, 640*1e3/dx);
ny = round(Int, 80*1e3/dx); #fix the number of grid-cells in the x and y directions to match set extents</code></pre><p>Velocity boundary conditions are controlled by specifying zeros in appropriate entries in arrays, which are then passed to the grid. We first build arrays, and then populate them with entries which enforce the boundary conditions:</p><pre><code class="language-julia hljs">u_iszero = falses(nx+1,ny); #build x-direction velocity boundary condition matrix with no zero boundary conditions anywhere 
u_iszero[1,:].=true;        #set the x-direction velocity to zero at x = 0.
v_iszero=falses(nx,ny+1);   #build x-direction velocity boundary condition matrix with no zero boundary conditions anywhere 
v_iszero[:,1].=true;        #set the y-direction velocity to zero at y = 0 (free slip)
v_iszero[:,end].=true;       #set the y-direction velocity to zero at y = 84km (free slip)
v_iszero[1,:].=true;         #set the y-direction velocity to zero at x = 0km (no slip in combination with u_iszero)</code></pre><p>Now we build the grid as usual, passing the arrays we just constructed via optional arguments. </p><pre><code class="language-julia hljs">grid = Grid(nx = nx, 
            ny = ny,   
            dx = dx, 
            dy = dy,
            u_iszero = u_iszero, 
            v_iszero = v_iszero)</code></pre><h2 id="Solver-Parameters"><a class="docs-heading-anchor" href="#Solver-Parameters">Solver Parameters</a><a id="Solver-Parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Solver-Parameters" title="Permalink"></a></h2><p>In the first MISMIP experiment, we&#39;re want to get to the final steady state, and don&#39;t really care about the solution state along the way. In particular, we don&#39;t need to get the velocity right along the way, we just want have it correct eventually. We therefore set the number of iterations in the velocity solve to be small: at each timestep, the solver just does a small number of iterations, and the velocity is only approximate. But, since we do a lot of iterations getting to steady state, the velocity gets to the right thing eventually. The number of iterations in the velocity solve and other parameters relating to how the equations are solved, are set via a <code>SolverParams</code> object:</p><pre><code class="language-julia hljs">solver_params = SolverParams(maxiter_picard = 1)</code></pre><p>Explicitly, we set the number of iterations (formally, Picard iterations) to be as small as possible, i.e. one iteration.</p><h2 id="Make-the-model"><a class="docs-heading-anchor" href="#Make-the-model">Make the model</a><a id="Make-the-model-1"></a><a class="docs-heading-anchor-permalink" href="#Make-the-model" title="Permalink"></a></h2><p>Now we have our grid, bed, and solver parameters, we just need to set the appropriate initial conditions and physical parameters for MISMIP+, and then we can build our model. In MISMIP+, the initial condition is 100m thick ice everywhere and the accumulation rate is 0.3m/a:</p><pre><code class="language-julia hljs">initial_conditions = InitialConditions(initial_thickness = 100 .* ones(nx,ny));
params = Params( accumulation_rate = 0.3);</code></pre><p>Note that all other parameter values in WAVI have defaults set to the MISMIP+ values.</p><p>Now let&#39;s make our model! Note that we use the functional form of the bed:</p><pre><code class="language-julia hljs">model = Model(grid = grid,
            bed_elevation = mismip_plus_bed, 
            initial_conditions = initial_conditions,
            params = params, 
            solver_params = solver_params)</code></pre><h2 id="Assembling-the-Simulation"><a class="docs-heading-anchor" href="#Assembling-the-Simulation">Assembling the Simulation</a><a id="Assembling-the-Simulation-1"></a><a class="docs-heading-anchor-permalink" href="#Assembling-the-Simulation" title="Permalink"></a></h2><p>To get to steady state, we need to run our simulation for a good chunk of time, on the order of tens of 1000s of years. We&#39;ll run for 10000 years, with a timestep of half a year:</p><pre><code class="language-julia hljs">timestepping_params = TimesteppingParams(dt = 0.5, 
                                        end_time = 10000.,)</code></pre><p>Note that as in other example, we have to specify the end time as <code>10000.</code> (a float number) rather than <code>10000</code> (an integer) because WAVI.jl expects the same numeric type for the timestep <code>dt</code> and the end time <code>end_time</code>.</p><p>We&#39;ll output the solution along the way, and use this to convince ourselves later than we are in steady state. First let&#39;s make a directory to store the output</p><pre><code class="language-julia hljs">folder = joinpath(@__DIR__, &quot;mismip&quot;);
isdir(folder) &amp;&amp; rm(folder, force = true, recursive = true);
mkdir(folder) ;</code></pre><p>Then we define our output parameters. We&#39;ll output the thickness and grounded fraction every 200 years, and set the zip_format keyword argument to zip the output files to an nc format when the simulation is finished.</p><pre><code class="language-julia hljs">output_params = OutputParams(outputs = (h = model.fields.gh.h,grfrac = model.fields.gh.grounded_fraction),
                            output_freq = 200.,
                            output_path = folder,
                            zip_format = &quot;nc&quot;);</code></pre><p>Now we assemble our simulation, taking in the model, output parameters and timestepping_params:</p><pre><code class="language-julia hljs">simulation = Simulation(model = model, timestepping_params = timestepping_params, output_params = output_params)</code></pre><h2 id="Timestepping"><a class="docs-heading-anchor" href="#Timestepping">Timestepping</a><a id="Timestepping-1"></a><a class="docs-heading-anchor-permalink" href="#Timestepping" title="Permalink"></a></h2><p>Now all that&#39;s left to do is run our simulation! This is a long simulation and might take a while (~10 mins on my laptop)</p><pre><code class="language-julia hljs">run_simulation!(simulation)</code></pre><h2 id="Visualization"><a class="docs-heading-anchor" href="#Visualization">Visualization</a><a id="Visualization-1"></a><a class="docs-heading-anchor-permalink" href="#Visualization" title="Permalink"></a></h2><p>Let&#39;s have a look at the steady state thickness:</p><pre><code class="language-julia hljs">Plots.heatmap(simulation.model.grid.xxh[:,1]/1e3, simulation.model.grid.yyh[1,:]/1e3, simulation.model.fields.gh.h&#39;, 
                xlabel = &quot;x (km)&quot;, 
                ylabel = &quot;y (km)&quot;,
                colorbar_title = &quot;ice thickness (m)&quot;)</code></pre><p>And add the grounding line, which is where the grounded fraction transitions between 0 and 1 (grounded_fraction takes the value 1 at fully grounded grid points and 0 at fully floating grid points.) Our choice of 0.5 is somewhat arbitrary here – any value between 0 and 1 will do!</p><pre><code class="language-julia hljs">Plots.contour!(simulation.model.grid.xxh[:,1]/1e3, 
            simulation.model.grid.yyh[1,:]/1e3,
            simulation.model.fields.gh.grounded_fraction&#39;,
            fill = false,
            levels = [0.5,0.5],
            linecolor = :blue,
            linewidth = 2)
plot!(size = (1000,550))</code></pre><p>You can see, by comparing with the plot of the bed earlier, that the grounding line sits on an overdeepened section of the bed! You can also compare it with the other MISMIP submissions (figure 3 in <a href="https://tc.copernicus.org/articles/14/2283/2020/">Cornford et al., 2020</a>) and see that the grounding line position agrees pretty well with other models, despite being lower resolution.</p><center><img src="https://raw.githubusercontent.com/RJArthern/WAVI.jl/build-docs/docs/src/assets/example-plots/MISMIP/mismip_thickness_and_gl.png" alt="" title="" width="600" height="600" /></center><p>Finally, let&#39;s check that it&#39;s in steady state, by looking at the evolution of the volume above floatation:</p><pre><code class="language-julia hljs">filename = joinpath(folder, &quot;outfile.nc&quot;);
h = ncread(filename, &quot;h&quot;);
grfrac = ncread(filename, &quot;grfrac&quot;);
time = ncread(filename, &quot;TIME&quot;);
#compute the volume above floatation
vaf = zeros(1,length(time))
for i = 1:length(time)
    vaf[i] = volume_above_floatation(h[:,:,i], simulation.model.fields.gh.b, Ref(simulation.model.params), simulation.model.grid )
end
Plots.plot(time, vaf[:]/1e9,
             marker = true, 
             label = :none,
             xlabel = &quot;time (years)&quot;,
             ylabel = &quot;volume above floatation (km^3)&quot;,
             framestyle = :box)</code></pre><p>The volume above floatation reaches a plateau, suggesting that we have indeed reached a steady state.</p><center><img src="https://raw.githubusercontent.com/RJArthern/WAVI.jl/build-docs/docs/src/assets/example-plots/MISMIP/mismip_vaf_evolution.png" alt="" title="" width="600" height="600" /></center><p>Finally, we clear up the files we just outputted</p><pre><code class="language-julia hljs">rm(folder, force = true, recursive = true)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../planar_1D_flow/">« First example: one-dimensional planar flow</a><a class="docs-footer-nextpage" href="../mismip_plus_retreat/">MISMIP+ part two: retreat experiments »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Wednesday 10 January 2024 14:42">Wednesday 10 January 2024</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
