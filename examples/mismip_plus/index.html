<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>MISMIP+ example · WAVI.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="WAVI.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">WAVI.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../installation_instructions/">Installation instructions</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../planar_1D_flow/">First example: one-dimensional planar flow</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">Physics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../physics/overview/">Overview</a></li><li><a class="tocitem" href="../../physics/governing_equations/">Governing Equations</a></li><li><a class="tocitem" href="../../physics/melting/">Melt Rates</a></li></ul></li><li><a class="tocitem" href="../../numerical_procedure/numerical_procedure/">Numerical Implementation</a></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">WAVI Setup</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../data_structure/overview/">Overview</a></li><li><a class="tocitem" href="../../data_structure/simulations/">Simulations</a></li><li><a class="tocitem" href="../../data_structure/model/">Models</a></li><li><a class="tocitem" href="../../data_structure/timestepping_params/">Timestepping Parameters</a></li><li><a class="tocitem" href="../../data_structure/output_writing/">Output Writing</a></li><li><a class="tocitem" href="../../data_structure/grid/">Grid</a></li><li><a class="tocitem" href="../../data_structure/solver_parameters/">Solver Parameters</a></li><li><a class="tocitem" href="../../data_structure/params/">Physical Paramters</a></li><li><a class="tocitem" href="../../data_structure/initial_conditions/">Initial Conditions</a></li><li><a class="tocitem" href="../../data_structure/fields/">Fields</a></li><li><a class="tocitem" href="../../data_structure/melt_rate_models/">Melt Rate Models</a></li></ul></li><li><a class="tocitem" href="../../mitgcm_coupling/">MITgcm coupling</a></li><li><a class="tocitem" href="../../contact/">Contact us</a></li><li><a class="tocitem" href="../../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>MISMIP+ example</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>MISMIP+ example</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/RJArthern/WAVI.jl/blob/main/docs/src/examples/mismip_plus.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="MISMIP-example"><a class="docs-heading-anchor" href="#MISMIP-example">MISMIP+ example</a><a id="MISMIP-example-1"></a><a class="docs-heading-anchor-permalink" href="#MISMIP-example" title="Permalink"></a></h1><p>This example shows how to recreate the Marine Ice Sheet Model Intercomparison (MISMIP) (doi: 10.5194/tc-14-2283-2020) experiments. In this intercomparison exercise, a two-dimensional ice sheet is considered, with a grounding line that can stabilize on a section of bed which has a locally positive slope in the flow direction (commonly called retrograde). This is interesting because grounding lines on retrograde bedslopes are theoretically unstable in one horizontal dimension (see doi: 10.1029/2006JF000664), demonstrating the importance of variations in the second dimension for buttressing ice sheets. Note that here we use a very coarse (8km) resolution for computational speed. </p><p>This example demonstrates how to </p><ul><li>apply boundary conditions</li><li>control the number of iterations in the velocity solve</li><li>zip the output into nc file format</li><li>apply simple formulations of melting</li></ul><h2 id="Install-dependencies"><a class="docs-heading-anchor" href="#Install-dependencies">Install dependencies</a><a id="Install-dependencies-1"></a><a class="docs-heading-anchor-permalink" href="#Install-dependencies" title="Permalink"></a></h2><p>First let&#39;s make sure we have all required packages installed.</p><pre><code class="language-julia hljs">using Pkg
Pkg.add(url=&quot;https://github.com/RJArthern/WAVI.jl&quot;)
Pkg.add(&quot;Plots&quot;)
Pkg.add(&quot;NetCDF&quot;)
using WAVI, Plots</code></pre><h2 id="Basal-Topography"><a class="docs-heading-anchor" href="#Basal-Topography">Basal Topography</a><a id="Basal-Topography-1"></a><a class="docs-heading-anchor-permalink" href="#Basal-Topography" title="Permalink"></a></h2><p>The MISMIP+ domain is 640km in the x-direction and 80km in the y-direction, centred around <span>$y = 0$</span>. The basal topography is given by <span>$z_b = \max [B_x(x) + B_y(y), -720] where $B_x(x)$</span> is a sixth order, even polynomial and <span>$B_y(y)$</span> introduces two bumps in the domain. We write this analytic bed expression as a function</p><pre><code class="language-julia hljs">function mismip_plus_bed(x,y)
    xbar = 300000.0
    b0 = -150.0; b2 = -728.8; b4 = 343.91; b6 = -50.75;
    wc = 24000.0; fc = 4000.0; dc = 500.0;
    bx(x)=b0+b2*(x/xbar)^2+b4*(x/xbar)^4+b6*(x/xbar)^6;
    by(y)= dc*( (1+exp(-2(y-wc)/fc))^(-1) + (1+exp(2(y+wc)/fc))^(-1) );
    b = max(bx(x) + by(y), -720.0);
    return b;
end</code></pre><p>First, let&#39;s take a look at this bed. We&#39;ll define the grid sizes and build some arrays, so we can plot. Here, we&#39;ll use a high resolution to get a nice plot, but when we run the simulation, we&#39;ll use a lower resolution</p><pre><code class="language-julia hljs">dx = 1.e3;
dy = 1.e3;
nx = round(Int, 640*1e3/dx);
ny = round(Int, 80*1e3/dx);
xx=[i*dx for i=1:nx, j=1:ny];
yy=[j*dy for i=1:nx, j=1:ny] .- 42000;
x = xx[:,1];
y = yy[1,:];

# Now we can plot
plt =  Plots.heatmap(x/1e3, y/1e3, mismip_plus_bed.(xx,yy)&#39;, 
                    xlabel = &quot;x (km)&quot;, 
                    ylabel = &quot;y (km)&quot;,
                    colorbar_title = &quot;bed depth (m)&quot;)
plot!(size = (800,400))</code></pre><h2 id="Boundary-Conditions"><a class="docs-heading-anchor" href="#Boundary-Conditions">Boundary Conditions</a><a id="Boundary-Conditions-1"></a><a class="docs-heading-anchor-permalink" href="#Boundary-Conditions" title="Permalink"></a></h2><p>In the MISMIP+ experiment, no slip (zero velocity in both directions) boundary conditions are applied at <span>$x = 0$</span>, and free-slip boundary conditions (zero velocity in the direction normal to the walls) are applied at the lateral boundaries at <span>$y = 0$</span>km and <span>$y = 84$</span>km. First, let&#39;s redefine the grid size to be lower resolution (to make the later simulations quicker)</p><pre><code class="language-julia hljs">dx = 8.e3;
dy = 8.e3;
nx = round(Int, 640*1e3/dx);
ny = round(Int, 80*1e3/dx); #fix the number of grid-cells in the x and y directions to match set extents</code></pre><h1 id="Velocity-boundary-conditions-are-controlled-by-specifying-zeros-in-appropriate-entries-in-arrays,-which-are-then-passed-to-the-grid:"><a class="docs-heading-anchor" href="#Velocity-boundary-conditions-are-controlled-by-specifying-zeros-in-appropriate-entries-in-arrays,-which-are-then-passed-to-the-grid:">Velocity boundary conditions are controlled by specifying zeros in appropriate entries in arrays, which are then passed to the grid:</a><a id="Velocity-boundary-conditions-are-controlled-by-specifying-zeros-in-appropriate-entries-in-arrays,-which-are-then-passed-to-the-grid:-1"></a><a class="docs-heading-anchor-permalink" href="#Velocity-boundary-conditions-are-controlled-by-specifying-zeros-in-appropriate-entries-in-arrays,-which-are-then-passed-to-the-grid:" title="Permalink"></a></h1><p>u<em>iszero = falses(nx+1,ny); #build x-direction velocity boundary condition matrix with no zero boundary conditions anywhere  u</em>iszero[1,:].=true;        #set the x-direction velocity to zero at x = 0. v<em>iszero=falses(nx,ny+1);   #build x-direction velocity boundary condition matrix with no zero boundary conditions anywhere  v</em>iszero[:,1].=true;        #set the y-direction velocity to zero at y = 0 (free slip) v<em>iszero[:,end].=true;       #set the y-direction velocity to zero at y = 84km (free slip) v</em>iszero[1,:].=true;         #set the y-direction velocity to zero at x = 0km (no slip in combination with u_iszero)</p><h1 id="Now-we-build-the-grid-as-usual,-passing-the-arrays-we-just-constructed-via-optional-arguments."><a class="docs-heading-anchor" href="#Now-we-build-the-grid-as-usual,-passing-the-arrays-we-just-constructed-via-optional-arguments.">Now we build the grid as usual, passing the arrays we just constructed via optional arguments.</a><a id="Now-we-build-the-grid-as-usual,-passing-the-arrays-we-just-constructed-via-optional-arguments.-1"></a><a class="docs-heading-anchor-permalink" href="#Now-we-build-the-grid-as-usual,-passing-the-arrays-we-just-constructed-via-optional-arguments." title="Permalink"></a></h1><p>grid = Grid(nx = nx,              ny = ny,                dx = dx,              dy = dy,             u<em>iszero = u</em>iszero,              v<em>iszero = v</em>iszero);</p><h1 id="-Solver-Parameters"><a class="docs-heading-anchor" href="###-Solver-Parameters">## Solver Parameters</a><a id="-Solver-Parameters-1"></a><a class="docs-heading-anchor-permalink" href="###-Solver-Parameters" title="Permalink"></a></h1><h1 id="We&#39;re-interested-in-the-steady-state-reached-at-late-times,-rather-than-the-solution-along-the-way.-We-don&#39;t-need-to-get-the-velocity-right-along-the-way,-just-have-it-correct-eventually."><a class="docs-heading-anchor" href="#We&#39;re-interested-in-the-steady-state-reached-at-late-times,-rather-than-the-solution-along-the-way.-We-don&#39;t-need-to-get-the-velocity-right-along-the-way,-just-have-it-correct-eventually.">We&#39;re interested in the steady state reached at late times, rather than the solution along the way. We don&#39;t need to get the velocity right along the way, just have it correct eventually.</a><a id="We&#39;re-interested-in-the-steady-state-reached-at-late-times,-rather-than-the-solution-along-the-way.-We-don&#39;t-need-to-get-the-velocity-right-along-the-way,-just-have-it-correct-eventually.-1"></a><a class="docs-heading-anchor-permalink" href="#We&#39;re-interested-in-the-steady-state-reached-at-late-times,-rather-than-the-solution-along-the-way.-We-don&#39;t-need-to-get-the-velocity-right-along-the-way,-just-have-it-correct-eventually." title="Permalink"></a></h1><h1 id="We-therefore-set-the-number-of-iterations-in-the-velocity-solve-to-be-small:-at-each-timestep,-the-solver-just-does-a-small-number-of-iterations,-and-the-velocity-is-only-approximate.-But,-since-we-do-a-lot-of-iterations-getting-to-steady-state,-the-velocity-gets-to-the-right-thing-eventually."><a class="docs-heading-anchor" href="#We-therefore-set-the-number-of-iterations-in-the-velocity-solve-to-be-small:-at-each-timestep,-the-solver-just-does-a-small-number-of-iterations,-and-the-velocity-is-only-approximate.-But,-since-we-do-a-lot-of-iterations-getting-to-steady-state,-the-velocity-gets-to-the-right-thing-eventually.">We therefore set the number of iterations in the velocity solve to be small: at each timestep, the solver just does a small number of iterations, and the velocity is only approximate. But, since we do a lot of iterations getting to steady state, the velocity gets to the right thing eventually.</a><a id="We-therefore-set-the-number-of-iterations-in-the-velocity-solve-to-be-small:-at-each-timestep,-the-solver-just-does-a-small-number-of-iterations,-and-the-velocity-is-only-approximate.-But,-since-we-do-a-lot-of-iterations-getting-to-steady-state,-the-velocity-gets-to-the-right-thing-eventually.-1"></a><a class="docs-heading-anchor-permalink" href="#We-therefore-set-the-number-of-iterations-in-the-velocity-solve-to-be-small:-at-each-timestep,-the-solver-just-does-a-small-number-of-iterations,-and-the-velocity-is-only-approximate.-But,-since-we-do-a-lot-of-iterations-getting-to-steady-state,-the-velocity-gets-to-the-right-thing-eventually." title="Permalink"></a></h1><h1 id="This-number,-and-other-parameters-relating-to-how-the-equations-are-solved,-are-set-via-a-SolverParams-object:"><a class="docs-heading-anchor" href="#This-number,-and-other-parameters-relating-to-how-the-equations-are-solved,-are-set-via-a-SolverParams-object:">This number, and other parameters relating to how the equations are solved, are set via a <code>SolverParams</code> object:</a><a id="This-number,-and-other-parameters-relating-to-how-the-equations-are-solved,-are-set-via-a-SolverParams-object:-1"></a><a class="docs-heading-anchor-permalink" href="#This-number,-and-other-parameters-relating-to-how-the-equations-are-solved,-are-set-via-a-SolverParams-object:" title="Permalink"></a></h1><p>solver<em>params = SolverParams(maxiter</em>picard = 1);</p><h1 id="Explicitly,-we-set-the-number-of-iterations-(formally,-Picard-iterations)-to-be-as-small-as-possible,-i.e.-one-iteration."><a class="docs-heading-anchor" href="#Explicitly,-we-set-the-number-of-iterations-(formally,-Picard-iterations)-to-be-as-small-as-possible,-i.e.-one-iteration.">Explicitly, we set the number of iterations (formally, Picard iterations) to be as small as possible, i.e. one iteration.</a><a id="Explicitly,-we-set-the-number-of-iterations-(formally,-Picard-iterations)-to-be-as-small-as-possible,-i.e.-one-iteration.-1"></a><a class="docs-heading-anchor-permalink" href="#Explicitly,-we-set-the-number-of-iterations-(formally,-Picard-iterations)-to-be-as-small-as-possible,-i.e.-one-iteration." title="Permalink"></a></h1><h1 id="-Make-the-model"><a class="docs-heading-anchor" href="###-Make-the-model">## Make the model</a><a id="-Make-the-model-1"></a><a class="docs-heading-anchor-permalink" href="###-Make-the-model" title="Permalink"></a></h1><h1 id="Now-we-have-our-grid,-bed,-and-solver-parameters,-we-just-need-to-set-the-appropriate-initial-conditions-and-physical-parameters-for-MISMIP,-and-then-we-can-build-our-model."><a class="docs-heading-anchor" href="#Now-we-have-our-grid,-bed,-and-solver-parameters,-we-just-need-to-set-the-appropriate-initial-conditions-and-physical-parameters-for-MISMIP,-and-then-we-can-build-our-model.">Now we have our grid, bed, and solver parameters, we just need to set the appropriate initial conditions and physical parameters for MISMIP+, and then we can build our model.</a><a id="Now-we-have-our-grid,-bed,-and-solver-parameters,-we-just-need-to-set-the-appropriate-initial-conditions-and-physical-parameters-for-MISMIP,-and-then-we-can-build-our-model.-1"></a><a class="docs-heading-anchor-permalink" href="#Now-we-have-our-grid,-bed,-and-solver-parameters,-we-just-need-to-set-the-appropriate-initial-conditions-and-physical-parameters-for-MISMIP,-and-then-we-can-build-our-model." title="Permalink"></a></h1><h1 id="In-MISMIP,-the-initial-condition-specifies-100m-thick-ice-everywhere"><a class="docs-heading-anchor" href="#In-MISMIP,-the-initial-condition-specifies-100m-thick-ice-everywhere">In MISMIP+, the initial condition specifies 100m thick ice everywhere</a><a id="In-MISMIP,-the-initial-condition-specifies-100m-thick-ice-everywhere-1"></a><a class="docs-heading-anchor-permalink" href="#In-MISMIP,-the-initial-condition-specifies-100m-thick-ice-everywhere" title="Permalink"></a></h1><p>initial<em>conditions = InitialConditions(initial</em>thickness = 100 .* ones(nx,ny));</p><h1 id="And-the-accumulation-rate-is-set-to-0.3m/a-(all-other-defaults-in-WAVI-are-chosen-according-to-the-values-in-MISMIP)"><a class="docs-heading-anchor" href="#And-the-accumulation-rate-is-set-to-0.3m/a-(all-other-defaults-in-WAVI-are-chosen-according-to-the-values-in-MISMIP)">And the accumulation rate is set to 0.3m/a (all other defaults in WAVI are chosen according to the values in MISMIP+)</a><a id="And-the-accumulation-rate-is-set-to-0.3m/a-(all-other-defaults-in-WAVI-are-chosen-according-to-the-values-in-MISMIP)-1"></a><a class="docs-heading-anchor-permalink" href="#And-the-accumulation-rate-is-set-to-0.3m/a-(all-other-defaults-in-WAVI-are-chosen-according-to-the-values-in-MISMIP)" title="Permalink"></a></h1><p>params = Params( accumulation_rate = 0.3);</p><h1 id="Now-let&#39;s-make-our-model!-Note-that-we-use-the-functional-form-of-the-bed-(the-array-we-plotted-earlier-has-higher-resolution-than-our-model-has)"><a class="docs-heading-anchor" href="#Now-let&#39;s-make-our-model!-Note-that-we-use-the-functional-form-of-the-bed-(the-array-we-plotted-earlier-has-higher-resolution-than-our-model-has)">Now let&#39;s make our model! Note that we use the functional form of the bed (the array we plotted earlier has higher resolution than our model has)</a><a id="Now-let&#39;s-make-our-model!-Note-that-we-use-the-functional-form-of-the-bed-(the-array-we-plotted-earlier-has-higher-resolution-than-our-model-has)-1"></a><a class="docs-heading-anchor-permalink" href="#Now-let&#39;s-make-our-model!-Note-that-we-use-the-functional-form-of-the-bed-(the-array-we-plotted-earlier-has-higher-resolution-than-our-model-has)" title="Permalink"></a></h1><p>model = Model(grid = grid,             bed<em>elevation = mismip</em>plus<em>bed,              initial</em>conditions = initial<em>conditions,             params = params,              solver</em>params = solver_params);</p><h1 id="-Assembling-the-Simulation"><a class="docs-heading-anchor" href="###-Assembling-the-Simulation">## Assembling the Simulation</a><a id="-Assembling-the-Simulation-1"></a><a class="docs-heading-anchor-permalink" href="###-Assembling-the-Simulation" title="Permalink"></a></h1><h1 id="To-get-to-steady-state,-we-need-to-run-our-simulation-for-a-good-chunk-of-time,-on-the-order-of-tens-of-1000s-of-years.-We&#39;ll-run-for-10000-years,-with-a-timestep-of-half-a-year:"><a class="docs-heading-anchor" href="#To-get-to-steady-state,-we-need-to-run-our-simulation-for-a-good-chunk-of-time,-on-the-order-of-tens-of-1000s-of-years.-We&#39;ll-run-for-10000-years,-with-a-timestep-of-half-a-year:">To get to steady state, we need to run our simulation for a good chunk of time, on the order of tens of 1000s of years. We&#39;ll run for 10000 years, with a timestep of half a year:</a><a id="To-get-to-steady-state,-we-need-to-run-our-simulation-for-a-good-chunk-of-time,-on-the-order-of-tens-of-1000s-of-years.-We&#39;ll-run-for-10000-years,-with-a-timestep-of-half-a-year:-1"></a><a class="docs-heading-anchor-permalink" href="#To-get-to-steady-state,-we-need-to-run-our-simulation-for-a-good-chunk-of-time,-on-the-order-of-tens-of-1000s-of-years.-We&#39;ll-run-for-10000-years,-with-a-timestep-of-half-a-year:" title="Permalink"></a></h1><p>timestepping<em>params = TimesteppingParams(dt = 0.5,                                          end</em>time = 100.,);</p><h1 id="NB!!-We-have-to-specify-the-end-time-as-10000.-(a-float-number)-rather-than-10000-(an-integer)-because-WAVI.jl-expects-the-same-type-for-the-timestep-dt-and-the-end-time-end_time."><a class="docs-heading-anchor" href="#NB!!-We-have-to-specify-the-end-time-as-10000.-(a-float-number)-rather-than-10000-(an-integer)-because-WAVI.jl-expects-the-same-type-for-the-timestep-dt-and-the-end-time-end_time.">NB!! We have to specify the end time as <code>10000.</code> (a float number) rather than <code>10000</code> (an integer) because WAVI.jl expects the same type for the timestep <code>dt</code> and the end time <code>end_time</code>.</a><a id="NB!!-We-have-to-specify-the-end-time-as-10000.-(a-float-number)-rather-than-10000-(an-integer)-because-WAVI.jl-expects-the-same-type-for-the-timestep-dt-and-the-end-time-end_time.-1"></a><a class="docs-heading-anchor-permalink" href="#NB!!-We-have-to-specify-the-end-time-as-10000.-(a-float-number)-rather-than-10000-(an-integer)-because-WAVI.jl-expects-the-same-type-for-the-timestep-dt-and-the-end-time-end_time." title="Permalink"></a></h1><h1 id="We&#39;ll-output-the-solution-along-the-way,-and-use-this-to-convince-ourselves-later-than-we-are-in-steady-state.-First-let&#39;s-make-a-directory-to-store-the-output"><a class="docs-heading-anchor" href="#We&#39;ll-output-the-solution-along-the-way,-and-use-this-to-convince-ourselves-later-than-we-are-in-steady-state.-First-let&#39;s-make-a-directory-to-store-the-output">We&#39;ll output the solution along the way, and use this to convince ourselves later than we are in steady state. First let&#39;s make a directory to store the output</a><a id="We&#39;ll-output-the-solution-along-the-way,-and-use-this-to-convince-ourselves-later-than-we-are-in-steady-state.-First-let&#39;s-make-a-directory-to-store-the-output-1"></a><a class="docs-heading-anchor-permalink" href="#We&#39;ll-output-the-solution-along-the-way,-and-use-this-to-convince-ourselves-later-than-we-are-in-steady-state.-First-let&#39;s-make-a-directory-to-store-the-output" title="Permalink"></a></h1><p>folder = joinpath(@<strong>DIR</strong>, &quot;overdeepened_bed&quot;); isdir(folder) &amp;&amp; rm(folder, force = true, recursive = true); mkdir(folder) ;</p><h1 id="Then-define-our-output-parameters.-We&#39;ll-output-the-thickness-and-grounded-fraction-every-200-years,-and-set-the-zip_format-keyword-argument-to-zip-the-output-files."><a class="docs-heading-anchor" href="#Then-define-our-output-parameters.-We&#39;ll-output-the-thickness-and-grounded-fraction-every-200-years,-and-set-the-zip_format-keyword-argument-to-zip-the-output-files.">Then define our output parameters. We&#39;ll output the thickness and grounded fraction every 200 years, and set the zip_format keyword argument to zip the output files.</a><a id="Then-define-our-output-parameters.-We&#39;ll-output-the-thickness-and-grounded-fraction-every-200-years,-and-set-the-zip_format-keyword-argument-to-zip-the-output-files.-1"></a><a class="docs-heading-anchor-permalink" href="#Then-define-our-output-parameters.-We&#39;ll-output-the-thickness-and-grounded-fraction-every-200-years,-and-set-the-zip_format-keyword-argument-to-zip-the-output-files." title="Permalink"></a></h1><p>output<em>params = OutputParams(outputs = (h = model.fields.gh.h,grfrac = model.fields.gh.grounded</em>fraction),                             output<em>freq = 10.,                             output</em>path = folder,                             zip_format = &quot;nc&quot;);</p><h1 id="Now-we-assemble-our-simulation,-taking-in-the-model,-output-parameters-and-timestepping_params:"><a class="docs-heading-anchor" href="#Now-we-assemble-our-simulation,-taking-in-the-model,-output-parameters-and-timestepping_params:">Now we assemble our simulation, taking in the model, output parameters and timestepping_params:</a><a id="Now-we-assemble-our-simulation,-taking-in-the-model,-output-parameters-and-timestepping_params:-1"></a><a class="docs-heading-anchor-permalink" href="#Now-we-assemble-our-simulation,-taking-in-the-model,-output-parameters-and-timestepping_params:" title="Permalink"></a></h1><p>simulation = Simulation(model = model, timestepping<em>params = timestepping</em>params, output<em>params = output</em>params);</p><h1 id="-Timestepping"><a class="docs-heading-anchor" href="###-Timestepping">## Timestepping</a><a id="-Timestepping-1"></a><a class="docs-heading-anchor-permalink" href="###-Timestepping" title="Permalink"></a></h1><h1 id="Now-all-that&#39;s-left-to-do-is-run-our-simulation!-This-is-a-long-simulation-and-might-take-a-while-(10-mins-on-my-laptop)"><a class="docs-heading-anchor" href="#Now-all-that&#39;s-left-to-do-is-run-our-simulation!-This-is-a-long-simulation-and-might-take-a-while-(10-mins-on-my-laptop)">Now all that&#39;s left to do is run our simulation! This is a long simulation and might take a while (~10 mins on my laptop)</a><a id="Now-all-that&#39;s-left-to-do-is-run-our-simulation!-This-is-a-long-simulation-and-might-take-a-while-(10-mins-on-my-laptop)-1"></a><a class="docs-heading-anchor-permalink" href="#Now-all-that&#39;s-left-to-do-is-run-our-simulation!-This-is-a-long-simulation-and-might-take-a-while-(10-mins-on-my-laptop)" title="Permalink"></a></h1><p>run_simulation!(simulation);</p><h1 id="-Visualization"><a class="docs-heading-anchor" href="###-Visualization">## Visualization</a><a id="-Visualization-1"></a><a class="docs-heading-anchor-permalink" href="###-Visualization" title="Permalink"></a></h1><h1 id="Let&#39;s-have-a-look-at-the-steady-state-thickness:"><a class="docs-heading-anchor" href="#Let&#39;s-have-a-look-at-the-steady-state-thickness:">Let&#39;s have a look at the steady state thickness:</a><a id="Let&#39;s-have-a-look-at-the-steady-state-thickness:-1"></a><a class="docs-heading-anchor-permalink" href="#Let&#39;s-have-a-look-at-the-steady-state-thickness:" title="Permalink"></a></h1><p>Plots.heatmap(simulation.model.grid.xxh[:,1]/1e3, simulation.model.grid.yyh[1,:]/1e3, simulation.model.fields.gh.h&#39;,                  xlabel = &quot;x (km)&quot;,                  ylabel = &quot;y (km)&quot;,                 colorbar_title = &quot;ice thickness (m)&quot;)</p><h1 id="And-add-the-grounding-line,-which-is-where-the-grounded-fraction-transitions-between-0-and-1-(grounded_fraction-takes-the-value-1-at-fully-grounded-grid-points-and-0-at-fully-floating-grid-points.)-Our-choice-of-0.5-is-somewhat-arbitrary-here-–-any-value-between-0-and-1-will-do!"><a class="docs-heading-anchor" href="#And-add-the-grounding-line,-which-is-where-the-grounded-fraction-transitions-between-0-and-1-(grounded_fraction-takes-the-value-1-at-fully-grounded-grid-points-and-0-at-fully-floating-grid-points.)-Our-choice-of-0.5-is-somewhat-arbitrary-here-–-any-value-between-0-and-1-will-do!">And add the grounding line, which is where the grounded fraction transitions between 0 and 1 (grounded_fraction takes the value 1 at fully grounded grid points and 0 at fully floating grid points.) Our choice of 0.5 is somewhat arbitrary here – any value between 0 and 1 will do!</a><a id="And-add-the-grounding-line,-which-is-where-the-grounded-fraction-transitions-between-0-and-1-(grounded_fraction-takes-the-value-1-at-fully-grounded-grid-points-and-0-at-fully-floating-grid-points.)-Our-choice-of-0.5-is-somewhat-arbitrary-here-–-any-value-between-0-and-1-will-do!-1"></a><a class="docs-heading-anchor-permalink" href="#And-add-the-grounding-line,-which-is-where-the-grounded-fraction-transitions-between-0-and-1-(grounded_fraction-takes-the-value-1-at-fully-grounded-grid-points-and-0-at-fully-floating-grid-points.)-Our-choice-of-0.5-is-somewhat-arbitrary-here-–-any-value-between-0-and-1-will-do!" title="Permalink"></a></h1><p>Plots.contour!(simulation.model.grid.xxh[:,1]/1e3,              simulation.model.grid.yyh[1,:]/1e3,             simulation.model.fields.gh.grounded_fraction&#39;,             fill = false,             levels = [0.5,0.5],             linecolor = :blue,             linewidth = 2) plot!(size = (1000,550))</p><h1 id="You-can-see,-by-comparing-with-the-plot-of-the-bed-earlier,-that-the-grounding-line-sits-on-an-overdeepened-section-of-the-bed!"><a class="docs-heading-anchor" href="#You-can-see,-by-comparing-with-the-plot-of-the-bed-earlier,-that-the-grounding-line-sits-on-an-overdeepened-section-of-the-bed!">You can see, by comparing with the plot of the bed earlier, that the grounding line sits on an overdeepened section of the bed!</a><a id="You-can-see,-by-comparing-with-the-plot-of-the-bed-earlier,-that-the-grounding-line-sits-on-an-overdeepened-section-of-the-bed!-1"></a><a class="docs-heading-anchor-permalink" href="#You-can-see,-by-comparing-with-the-plot-of-the-bed-earlier,-that-the-grounding-line-sits-on-an-overdeepened-section-of-the-bed!" title="Permalink"></a></h1><h1 id="Finally,-let&#39;s-check-that-it&#39;s-in-steady-state,-by-looking-at-the-evolution-of-the-volume-above-floatation:"><a class="docs-heading-anchor" href="#Finally,-let&#39;s-check-that-it&#39;s-in-steady-state,-by-looking-at-the-evolution-of-the-volume-above-floatation:">Finally, let&#39;s check that it&#39;s in steady state, by looking at the evolution of the volume above floatation:</a><a id="Finally,-let&#39;s-check-that-it&#39;s-in-steady-state,-by-looking-at-the-evolution-of-the-volume-above-floatation:-1"></a><a class="docs-heading-anchor-permalink" href="#Finally,-let&#39;s-check-that-it&#39;s-in-steady-state,-by-looking-at-the-evolution-of-the-volume-above-floatation:" title="Permalink"></a></h1><p>filename = joinpath(@<strong>DIR</strong>, &quot;overdeepened<em>bed&quot;, &quot;outfile.nc&quot;); h = ncread(filename, &quot;h&quot;); grfrac = ncread(filename, &quot;grfrac&quot;); time = ncread(filename, &quot;TIME&quot;); #compute the volume above floatation vaf = zeros(1,length(time)) for i = 1:length(time)     vaf[i] = volume</em>above_floatation(h[:,:,i], simulation.model.fields.gh.b, Ref(simulation.model.params), simulation.model.grid ) end Plots.plot(time, vaf[:]/1e9,              marker = true,               label = :none,              xlabel = &quot;time&quot;,              ylabel = &quot;volume above floatation (km^3)&quot;,              framestyle = :box)</p><h1 id="The-volume-above-floatation-reaches-a-plateau,-suggesting-that-we-have-reached-a-steady-state."><a class="docs-heading-anchor" href="#The-volume-above-floatation-reaches-a-plateau,-suggesting-that-we-have-reached-a-steady-state.">The volume above floatation reaches a plateau, suggesting that we have reached a steady state.</a><a id="The-volume-above-floatation-reaches-a-plateau,-suggesting-that-we-have-reached-a-steady-state.-1"></a><a class="docs-heading-anchor-permalink" href="#The-volume-above-floatation-reaches-a-plateau,-suggesting-that-we-have-reached-a-steady-state." title="Permalink"></a></h1><h1 id="Finally,-we-clear-up-the-files-we-just-outputted"><a class="docs-heading-anchor" href="#Finally,-we-clear-up-the-files-we-just-outputted">Finally, we clear up the files we just outputted</a><a id="Finally,-we-clear-up-the-files-we-just-outputted-1"></a><a class="docs-heading-anchor-permalink" href="#Finally,-we-clear-up-the-files-we-just-outputted" title="Permalink"></a></h1><p>rm(folder, force = true, recursive = true);</p></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Wednesday 3 May 2023 19:35">Wednesday 3 May 2023</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
